<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Norsk QuickTalk ‚Äì Daily Norwegian for Work & Life</title>
  <meta name="description" content="Multi-language pocket phrasebook for Norway & Finland. Construction-first vocab, daily life phrases, search, TTS, icons, favorites, currency converter, Bergen places, and image search. Works anywhere as a static page." />
  <style>
    :root {
      --bg: #0f1115;
      --panel: #171a21;
      --muted: #9aa4b2;
      --text: #e8eef6;
      --accent: #ff7a18;
      --accent-2: #6ee7b7;
      --card: #141821;
      --chip: #242a36;
      --border: #2b3240;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 14px;
      --pad: 14px;
      --gap: 10px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Noto Sans", Arial;
    }
    
    [data-theme="light"] {
      --bg: #f7f7fb;
      --panel: #ffffff;
      --muted: #5b6573;
      --text: #0f1222;
      --accent: #0d9488;
      --accent-2: #ef4444;
      --card: #ffffff;
      --chip: #f0f2f7;
      --border: #e5e7eb;
      --shadow: 0 6px 18px rgba(2,8,23,.08);
    }
    
    [data-theme="black-orange"] {
      --bg: #0a0a0b;
      --panel: #0f0f11;
      --muted: #a8b0bd;
      --text: #f0f3f9;
      --accent: #ff7a18;
      --accent-2: #ffb703;
      --card: #111217;
      --chip: #1a1d24;
      --border: #242834;
      --shadow: 0 12px 26px rgba(0,0,0,.5);
    }
    
    html, body {
      height: 100%;
    }
    
    body {
      margin: 0;
      font-family: var(--font);
      background: radial-gradient(1200px 600px at 10% -10%, rgba(255,122,24,.06), transparent),
                  radial-gradient(1000px 600px at 110% 10%, rgba(110,231,183,.05), transparent),
                  var(--bg);
      color: var(--text);
    }
    
    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr;
      margin-bottom: 16px;
    }
    
    .title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), #ffb703);
      display: grid;
      place-items: center;
      box-shadow: var(--shadow);
    }
    
    .logo svg {
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.25));
    }
    
    h1 {
      font-weight: 800;
      font-size: 1.35rem;
      margin: 0;
      letter-spacing: .3px;
    }
    
    .subtitle {
      color: var(--muted);
      font-size: .9rem;
    }
    
    .toolbar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      background: var(--panel);
      padding: 10px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .search {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--card);
      border: 1px solid var(--border);
      padding: 8px 10px;
      border-radius: 10px;
    }
    
    .search input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-size: 1rem;
    }
    
    .search input::placeholder {
      color: var(--muted);
      opacity: 0.7;
    }
    
    .btn, select {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn:hover, select:hover {
      border-color: var(--accent);
    }
    
    .btn.primary {
      background: linear-gradient(135deg, var(--accent), #ffb703);
      color: #0b0b0b;
      font-weight: 700;
      border: 0;
    }
    
    .btn.primary:hover {
      opacity: 0.9;
    }
    
    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--chip);
      border: 1px solid var(--border);
      cursor: pointer;
      user-select: none;
    }
    
    .toggle input[type="checkbox"] {
      cursor: pointer;
    }
    
    .chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 14px 0;
    }
    
    .chip {
      padding: 8px 12px;
      border: 1px solid var(--border);
      background: var(--chip);
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      color: var(--muted);
      transition: all 0.2s ease;
    }
    
    .chip:hover {
      border-color: var(--accent);
    }
    
    .chip.active {
      background: linear-gradient(135deg, rgba(255,122,24,.15), rgba(110,231,183,.15));
      border-color: transparent;
      color: var(--text);
    }
    
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    
    @media(min-width: 720px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: var(--shadow);
      display: grid;
      gap: 10px;
      transition: all 0.2s ease;
    }
    
    .card:hover {
      border-color: var(--accent);
    }
    
    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    
    .no {
      font-size: 1.05rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }
    
    .no .icon {
      font-size: 1.25rem;
      width: 1.6rem;
      height: 1.6rem;
      display: grid;
      place-items: center;
      border-radius: 10px;
      background: var(--card);
      border: 1px solid var(--border);
    }
    
    .en {
      color: var(--muted);
    }
    
    .actions {
      display: flex;
      gap: 6px;
    }
    
    .iconbtn {
      border: 1px solid var(--border);
      background: var(--card);
      padding: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text);
    }
    
    .iconbtn:hover {
      border-color: var(--accent);
      background: var(--chip);
    }
    
    .iconbtn[aria-pressed="true"] {
      outline: 2px solid var(--accent);
      background: var(--chip);
    }
    
    .footer {
      margin: 22px 0 40px;
      color: var(--muted);
      font-size: .9rem;
    }
    
    .cheats {
      display: grid;
      gap: 6px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 12px;
      margin-top: 8px;
    }
    
    .cheats b {
      color: var(--text);
    }
    
    mark {
      background: linear-gradient(90deg, rgba(255,122,24,.25), rgba(110,231,183,.25));
      border-radius: 4px;
      padding: 0 2px;
    }
    
    .hide-en .en {
      filter: blur(5px);
      transition: filter 0.2s ease;
    }
    
    .hide-en .card:hover .en {
      filter: none;
    }
    
    .small {
      font-size: .85rem;
    }
    
    .badge {
      font-size: .7rem;
      padding: .15rem .4rem;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: var(--chip);
      color: var(--muted);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    
    .empty-state svg {
      opacity: 0.5;
      margin-bottom: 10px;
    }
    
    /* Modal styles */
    .modal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
    }
    
    .modal-content {
      background: var(--panel);
      margin: 5% auto;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      width: 90%;
      max-width: 600px;
      box-shadow: var(--shadow);
    }
    
    .close {
      color: var(--muted);
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      line-height: 20px;
    }
    
    .close:hover,
    .close:focus {
      color: var(--accent);
    }
    
    .modal-content h2 {
      margin-top: 0;
      color: var(--text);
    }
    
    .calculator-grid {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }
    
    .calc-row {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }
    
    .calc-row input[type="number"] {
      flex: 1;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--card);
      color: var(--text);
      font-size: 1.1rem;
    }
    
    .calc-row select {
      flex: 1;
    }
    
    .rate-info {
      padding: 10px;
      background: var(--card);
      border-radius: 10px;
      text-align: center;
      color: var(--muted);
    }
    
    #placesList {
      max-height: 300px;
      overflow-y: auto;
      margin: 10px 0;
    }
    
    .place-item {
      padding: 10px;
      margin: 5px 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #newPlaceName, #newPlaceCategory {
      padding: 8px;
      margin-right: 5px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--card);
      color: var(--text);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="app" id="app" data-theme="black-orange">
    <header>
      <div class="title">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 12a8 8 0 1116 0v5a3 3 0 01-3 3h-1l-2-2h-4l-2 2H7a3 3 0 01-3-3v-5z" fill="white" fill-opacity=".9"/>
            <path d="M9 12h6M8 9h8M10 15h4" stroke="#0f0f0f" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Norsk QuickTalk</h1>
          <div class="subtitle">Construction heavy. Daily life ready. Search, audio, icons, and a dash of site slang.</div>
        </div>
      </div>
      <div class="toolbar">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M11 19a8 8 0 100-16 8 8 0 000 16z" stroke="currentColor" stroke-width="1.5" opacity=".7"/>
            <path d="M21 21l-3.5-3.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" opacity=".7"/>
          </svg>
          <input id="q" placeholder="Search English or Norwegian or Finnish‚Ä¶ (e.g. 'hammer' / 'vasara')" aria-label="Search phrases" />
        </div>
        <select id="targetLang" aria-label="Select target language">
          <option value="no">üá≥üá¥ Norwegian</option>
          <option value="fi">üá´üáÆ Finnish</option>
        </select>
        <label class="toggle">
          <input type="checkbox" id="hideEn" aria-label="Hide English translations"/>
          <span>Hide English</span>
        </label>
        <label class="toggle">
          <input type="checkbox" id="onlyFav" aria-label="Show only favorites"/>
          <span>Favorites</span>
        </label>
        <select id="theme" aria-label="Select theme">
          <option value="black-orange">Black + Orange</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>
        <button class="btn primary" id="exportFav" aria-label="Export favorites">Export ‚òÖ</button>
        <button class="btn" id="currencyCalc" aria-label="Currency Calculator">üí± Calculator</button>
        <button class="btn" id="placesBtn" aria-label="Bergen Places">üìç Places</button>
      </div>
      <div class="chips" id="chips" role="tablist"></div>
    </header>
    <main>
      <section class="grid" id="list" aria-live="polite" role="region" aria-label="Phrase list"></section>
      
      <!-- Currency Calculator Modal -->
      <div id="currencyModal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" id="closeCurrency">&times;</span>
          <h2>üí± Currency Calculator</h2>
          <div class="calculator-grid">
            <div class="calc-row">
              <input type="number" id="fromAmount" value="100" step="0.01" />
              <select id="fromCurrency">
                <option value="NOK">NOK - Norwegian Krone</option>
                <option value="EUR">EUR - Euro</option>
                <option value="USD">USD - US Dollar</option>
                <option value="GBP">GBP - British Pound</option>
                <option value="SEK">SEK - Swedish Krona</option>
                <option value="DKK">DKK - Danish Krone</option>
              </select>
            </div>
            <div class="calc-row">
              <span style="font-size: 2rem;">‚¨áÔ∏è</span>
            </div>
            <div class="calc-row">
              <input type="number" id="toAmount" readonly />
              <select id="toCurrency">
                <option value="EUR">EUR - Euro</option>
                <option value="NOK">NOK - Norwegian Krone</option>
                <option value="USD">USD - US Dollar</option>
                <option value="GBP">GBP - British Pound</option>
                <option value="SEK">SEK - Swedish Krona</option>
                <option value="DKK">DKK - Danish Krone</option>
              </select>
            </div>
            <div class="calc-row">
              <button class="btn primary" id="convertBtn">Convert</button>
              <button class="btn" id="swapBtn">Swap üîÑ</button>
            </div>
            <div id="rateInfo" class="rate-info"></div>
          </div>
        </div>
      </div>

      <!-- Bergen Places Modal -->
      <div id="placesModal" class="modal" style="display: none;">
        <div class="modal-content">
          <span class="close" id="closePlaces">&times;</span>
          <h2>üìç Bergen Places</h2>
          <div id="mapContainer" style="height: 400px; background: var(--card); border-radius: 10px; margin: 10px 0;"></div>
          <div id="placesList"></div>
          <div style="margin-top: 10px;">
            <input type="text" id="newPlaceName" placeholder="Place name" />
            <input type="text" id="newPlaceCategory" placeholder="Category (e.g., Restaurant)" />
            <button class="btn primary" id="addPlaceBtn">Add Place</button>
          </div>
        </div>
      </div>
      
      <div class="footer">
        <div><b>Tip:</b> tap the star to save, the triangle to hear pronunciation, and the copy icon to grab text. Items in <span class="badge">slang</span> are site-talk‚Äîuse with a smile. Switch between Norwegian üá≥üá¥ and Finnish üá´üáÆ using the language selector.</div>
        <div class="cheats small">
          <div><b>Norwegian sounds:</b> <b>√•</b> ~ "aw" (as in <i>law</i>), <b>√∏</b> ~ "uh/eur" (French <i>peur</i>), <b>√¶</b> ~ "a" in <i>cat</i>. <b>kj</b> ‚âà soft <i>hy</i>, <b>skj</b>/<b>sj</b> ‚âà "sh".</div>
          <div><b>Finnish sounds:</b> <b>√§</b> ~ "a" in <i>cat</i>, <b>√∂</b> ~ German √∂, double vowels are long. All letters pronounced.</div>
          <div><b>Emergency numbers:</b> Norway: Police <b>112</b>, Ambulance <b>113</b>, Fire <b>110</b>. Finland: All emergencies <b>112</b>.</div>
          <div><b>Patterns:</b> <b>Jeg trenger ‚Ä¶</b> (I need ‚Ä¶) ‚Ä¢ <b>Hvor er ‚Ä¶?</b> (Where is ‚Ä¶?) ‚Ä¢ <b>Kan du ‚Ä¶?</b> (Can you ‚Ä¶?) ‚Ä¢ <b>Er det i vater?</b> (Is it level?)</div>
        </div>
      </div>
    </main>
  </div>
  
  <script>
    'use strict';
    
    const state = {
      q: '',
      cat: 'Construction (Byggeplass)',
      hideEn: false,
      onlyFav: false,
      theme: localStorage.getItem('nqt_theme') || 'black-orange',
      favs: new Set(JSON.parse(localStorage.getItem('nqt_favs') || '[]')),
      targetLang: localStorage.getItem('nqt_targetLang') || 'no', // 'no' or 'fi'
      ttsProvider: localStorage.getItem('nqt_ttsProvider') || 'browser', // 'browser', 'elevenlabs', 'openai'
      translationProvider: localStorage.getItem('nqt_translationProvider') || 'none', // 'none', 'deepl', 'google'
      savedWords: JSON.parse(localStorage.getItem('nqt_savedWords') || '[]'),
      savedPlaces: JSON.parse(localStorage.getItem('nqt_savedPlaces') || '[]'),
      exchangeRates: JSON.parse(localStorage.getItem('nqt_exchangeRates') || '{}'),
      lastRateUpdate: localStorage.getItem('nqt_lastRateUpdate') || null,
      learnProgress: JSON.parse(localStorage.getItem('nqt_learnProgress') || '{}'), // Track phrase usage
    };

    const CATS = [
      'Construction (Byggeplass)',
      'Tools & Equipment (Verkt√∏y)',
      'Tools Gallery (Ikoner)',
      'Site Slang (Bygge-slang)',
      'Small Talk (Sm√•prat)',
      'Shopping & Food (Butikk & Mat)',
      'Money & Exchange (Penger & Veksling)',
      'Transport (Transport)',
      'Health & Emergency (Helse & N√∏d)',
      'Housing & Utilities (Bolig & Tjenester)',
      'Admin (Papirer & Kontor)',
      'Numbers & Time (Tall & Tid)',
      'Bergen Places (Bergen Steder)',
      'Quantities (Mengder)',
      'Weather (V√¶r)',
      'Restaurants & Dining (Restaurant & Mat)',
      'Colors (Farger)',
      'Directions (Retninger)'
    ];

    // Helper functions to create phrase and word objects
    function P(cat, en, no, fi = '', icon = '') {
      return { id: id(en + no + cat), cat, type: 'phrase', en, no, fi: fi || no, icon };
    }
    
    function W(cat, en, no, fi = '', icon = '') {
      return { id: id(en + no + cat), cat, type: 'word', en, no, fi: fi || no, icon };
    }
    
    function Numbers(cat) {
      const N = [
        ['zero', 'null', 'nolla'], ['one', '√©n', 'yksi'], ['two', 'to', 'kaksi'], ['three', 'tre', 'kolme'],
        ['four', 'fire', 'nelj√§'], ['five', 'fem', 'viisi'], ['six', 'seks', 'kuusi'], ['seven', 'sju', 'seitsem√§n'],
        ['eight', '√•tte', 'kahdeksan'], ['nine', 'ni', 'yhdeks√§n'], ['ten', 'ti', 'kymmenen'], ['eleven', 'elleve', 'yksitoista'],
        ['twelve', 'tolv', 'kaksitoista'], ['thirteen', 'tretten', 'kolmetoista'], ['fourteen', 'fjorten', 'nelj√§toista'],
        ['fifteen', 'femten', 'viisitoista'], ['sixteen', 'seksten', 'kuusitoista'], ['seventeen', 'sytten', 'seitsem√§ntoista'],
        ['eighteen', 'atten', 'kahdeksantoista'], ['nineteen', 'nitten', 'yhdeks√§ntoista'], ['twenty', 'tjue', 'kaksikymment√§'],
        ['thirty', 'tretti', 'kolmekymment√§'], ['forty', 'f√∏rti', 'nelj√§kymment√§'], ['fifty', 'femti', 'viisikymment√§'],
        ['sixty', 'seksti', 'kuusikymment√§'], ['seventy', 'sytti', 'seitsem√§nkymment√§'], ['eighty', '√•tti', 'kahdeksankymment√§'],
        ['ninety', 'nitti', 'yhdeks√§nkymment√§'], ['one hundred', 'hundre', 'sata'],
        ['two hundred', 'to hundre', 'kaksisataa'], ['five hundred', 'fem hundre', 'viisisataa'],
        ['one thousand', 'tusen', 'tuhat']
      ];
      return N.map(([en, no, fi]) => W(cat, en, no, fi, '#'));
    }
    
    function id(s) {
      // Use modern approach instead of deprecated unescape()
      const bytes = new TextEncoder().encode(s);
      const binString = String.fromCharCode(...bytes);
      return btoa(binString).slice(0, 12);
    }

    // DATA
    const D = [
      // Construction talk
      P('Construction (Byggeplass)', "Where is the foreman?", 'Hvor er formannen?', 'Miss√§ on ty√∂njohtaja?'),
      P('Construction (Byggeplass)', "Can you show me the drawings?", 'Kan du vise meg tegningene?', 'Voitko n√§ytt√§√§ minulle piirustukset?'),
      P('Construction (Byggeplass)', "What's the measurement here?", 'Hva er m√•let her?', 'Mik√§ on mitta t√§ss√§?'),
      P('Construction (Byggeplass)', 'Cut to length, please.', 'Kapp til lengde, takk.', 'Katkaise pituuteen, kiitos.'),
      P('Construction (Byggeplass)', 'Is it level/straight?', 'Er det i vater/rett?', 'Onko se vaakatasossa/suora?'),
      P('Construction (Byggeplass)', 'Where do I get materials?', 'Hvor f√•r jeg materialer?', 'Mist√§ saan materiaalit?'),
      P('Construction (Byggeplass)', 'Watch out!', 'Pass p√•!', 'Varo!'),
      P('Construction (Byggeplass)', 'I understand / I do not understand.', 'Jeg forst√•r / Jeg forst√•r ikke.', 'Ymm√§rr√§n / En ymm√§rr√§.'),
      P('Construction (Byggeplass)', 'Can you speak slowly?', 'Kan du snakke sakte?', 'Voitko puhua hitaasti?'),

      // Hand tools
      W('Tools & Equipment (Verkt√∏y)', 'hammer', 'hammer', 'vasara', 'üî®'),
      W('Tools & Equipment (Verkt√∏y)', 'sledgehammer', 'slegge', 'moukari', 'üî®'),
      W('Tools & Equipment (Verkt√∏y)', 'nail puller/pry bar', 'brekkjern', 'sorkkarauta', 'üõ†Ô∏è'),
      W('Tools & Equipment (Verkt√∏y)', 'chisel', 'meisel', 'taltta', 'ü™ì'),
      W('Tools & Equipment (Verkt√∏y)', 'utility knife/box cutter', 'kniv', 'veitsi', 'üî™'),
      W('Tools & Equipment (Verkt√∏y)', 'tape measure', 'm√•leb√•nd', 'mittanauha', 'üìè'),
      W('Tools & Equipment (Verkt√∏y)', 'spirit level', 'vater', 'vesivaaka', 'üìê'),
      W('Tools & Equipment (Verkt√∏y)', 'speed square', 'vinkelhake', 'kulmamitta', 'üìê'),
      W('Tools & Equipment (Verkt√∏y)', 'plumb bob/laser plumb', 'lodd', 'luotivaaka', 'üìç'),
      W('Tools & Equipment (Verkt√∏y)', 'chalk line', 'snorslager/krittsnor', 'merkint√§naru', 'üßµ'),

      // Cutting & drilling
      W('Tools & Equipment (Verkt√∏y)', 'hand saw', 'h√•ndsag', 'k√§sisaha', 'ü™ö'),
      W('Tools & Equipment (Verkt√∏y)', 'circular saw', 'sirkelsag', 'py√∂r√∂saha', 'ü™ö'),
      W('Tools & Equipment (Verkt√∏y)', 'jigsaw', 'stikksag', 's√§hk√∂saha', 'ü™ö'),
      W('Tools & Equipment (Verkt√∏y)', 'reciprocating saw', 'tigersag', 'k√§√§nt√∂saha', 'ü™ö'),
      W('Tools & Equipment (Verkt√∏y)', 'table saw', 'bordsag', 'p√∂yt√§saha', 'ü™ö'),
      W('Tools & Equipment (Verkt√∏y)', 'miter saw', 'gj√¶rsag', 'jiirisaha', 'ü™ö'),
      W('Tools & Equipment (Verkt√∏y)', 'angle grinder', 'vinkelsliper', 'kulmahiomakone', 'üåÄ'),
      W('Tools & Equipment (Verkt√∏y)', 'oscillating multi-tool', 'multikutter', 'monitoimity√∂kalu', 'üåÄ'),
      W('Tools & Equipment (Verkt√∏y)', 'drill/driver', 'bormaskin/skruddral', 'porakone/ruuvinv√§√§nnin', 'üõ†Ô∏è'),
      W('Tools & Equipment (Verkt√∏y)', 'impact driver', 'slagtrekker', 'iskuporakone', 'üõ†Ô∏è'),
      W('Tools & Equipment (Verkt√∏y)', 'SDS rotary hammer', 'borhammer (SDS)', 'iskuvasara (SDS)', 'üõ†Ô∏è'),
      W('Tools & Equipment (Verkt√∏y)', 'core drill', 'kjernebor', 'timanttikairat', 'üõ†Ô∏è'),

      // Fastening
      W('Tools & Equipment (Verkt√∏y)', 'nail gun', 'spikerpistol', 'naulain', 'üî´'),
      W('Tools & Equipment (Verkt√∏y)', 'staple gun', 'stiftepistol', 'nitoja', 'üî´'),
      W('Tools & Equipment (Verkt√∏y)', 'caulk gun', 'fuggepistol', 'saumauspistooli', 'üß¥'),

      // Concrete & masonry
      W('Tools & Equipment (Verkt√∏y)', 'concrete mixer', 'betongblander', 'betonimylly', 'üåÄ'),
      W('Tools & Equipment (Verkt√∏y)', 'rebar bender/cutter', 'armeringsknekker/kutter', 'raudoituksen taivuttaja', 'üîß'),
      W('Tools & Equipment (Verkt√∏y)', 'trowel', 'murerkjele/murerskje', 'lastalapio', 'üß±'),
      W('Tools & Equipment (Verkt√∏y)', 'float', 'glattebrett', 'hierrin', 'üß±'),
      W('Tools & Equipment (Verkt√∏y)', 'plate compactor', 'platevibrator', 't√§ryl√§mp√∂', 'üì≥'),
      W('Tools & Equipment (Verkt√∏y)', 'jackhammer', 'meiselhammer/pigghammer', 'piikkirikki', 'üí•'),

      // Timber & finishing
      W('Tools & Equipment (Verkt√∏y)', 'planer', 'h√∏vel', 'h√∂yl√§', 'ü™µ'),
      W('Tools & Equipment (Verkt√∏y)', 'router', 'overfres', 'yl√§jyrsin', 'ü™µ'),
      W('Tools & Equipment (Verkt√∏y)', 'sander', 'sliper', 'hiomakone', 'ü™µ'),

      // Plumbing & electrical
      W('Tools & Equipment (Verkt√∏y)', 'pipe wrench', 'r√∏rtang', 'putkipihdit', 'üîß'),
      W('Tools & Equipment (Verkt√∏y)', 'pipe cutter', 'r√∏rkutter', 'putkileikkuri', 'üîß'),
      W('Tools & Equipment (Verkt√∏y)', 'tube bender', 'r√∏rb√∏yer', 'putkentaivutin', 'üîß'),
      W('Tools & Equipment (Verkt√∏y)', 'wire stripper', 'avmantlingstang', 'eristysraudat', 'üîå'),
      W('Tools & Equipment (Verkt√∏y)', 'crimper', 'krympeverkt√∏y', 'puristusty√∂kalu', 'üîå'),
      W('Tools & Equipment (Verkt√∏y)', 'multimeter', 'multimeter', 'yleismittari', 'üîå'),
      W('Tools & Equipment (Verkt√∏y)', 'voltage tester', 'spenningstester', 'j√§nnitteenkoettelija', 'üîå'),
      W('Tools & Equipment (Verkt√∏y)', 'conduit bender', 'k-r√∏rb√∏yer', 's√§hk√∂putken taivutin', 'üîå'),

      // Lifting & access
      W('Tools & Equipment (Verkt√∏y)', 'ladder', 'stige', 'tikkaat', 'ü™ú'),
      W('Tools & Equipment (Verkt√∏y)', 'scaffold', 'stillas', 'rakennustelineet', 'üßó'),
      W('Tools & Equipment (Verkt√∏y)', 'wheelbarrow', 'trilleb√•r', 'kottik√§rryt', 'üõí'),

      // Site gear
      W('Tools & Equipment (Verkt√∏y)', 'generator', 'aggregat', 'generaattori', '‚ö°'),
      W('Tools & Equipment (Verkt√∏y)', 'work light', 'arbeidslampe', 'ty√∂valo', 'üí°'),
      W('Tools & Equipment (Verkt√∏y)', 'extension cord', 'skj√∏teledning', 'jatkojohto', 'üîå'),
      W('Tools & Equipment (Verkt√∏y)', 'PPE (protective equipment)', 'verneutstyr', 'suojavarusteet', 'ü¶∫'),
      W('Tools & Equipment (Verkt√∏y)', 'safety helmet', 'vernehjelm', 'suojakyp√§r√§', 'ü™ñ'),
      W('Tools & Equipment (Verkt√∏y)', 'hearing protection', 'h√∏rselsvern', 'kuulosuojaimet', 'üéß'),
      W('Tools & Equipment (Verkt√∏y)', 'dust mask/respirator', 'st√∏vmaske/√•ndedrettsvern', 'p√∂lynaamari/hengityssuojain', 'üò∑'),

      // Tools Gallery (Icons only, same vocab)
      ...[
        ['hammer', 'hammer', 'vasara', 'üî®'], ['sledgehammer', 'slegge', 'moukari', 'üî®'], ['pry bar', 'brekkjern', 'sorkkarauta', 'üõ†Ô∏è'],
        ['chisel', 'meisel', 'taltta', 'ü™ì'], ['utility knife', 'kniv', 'veitsi', 'üî™'], ['tape measure', 'm√•leb√•nd', 'mittanauha', 'üìè'],
        ['spirit level', 'vater', 'vesivaaka', 'üìê'], ['square', 'vinkelhake', 'kulmamitta', 'üìê'], ['chalk line', 'snorslager', 'merkint√§naru', 'üßµ'],
        ['hand saw', 'h√•ndsag', 'k√§sisaha', 'ü™ö'], ['circular saw', 'sirkelsag', 'py√∂r√∂saha', 'ü™ö'], ['jigsaw', 'stikksag', 's√§hk√∂saha', 'ü™ö'],
        ['reciprocating saw', 'tigersag', 'k√§√§nt√∂saha', 'ü™ö'], ['table saw', 'bordsag', 'p√∂yt√§saha', 'ü™ö'], ['miter saw', 'gj√¶rsag', 'jiirisaha', 'ü™ö'],
        ['angle grinder', 'vinkelsliper', 'kulmahiomakone', 'üåÄ'], ['multi-tool', 'multikutter', 'monitoimity√∂kalu', 'üåÄ'], ['drill', 'bormaskin', 'porakone', 'üõ†Ô∏è'],
        ['impact driver', 'slagtrekker', 'iskuporakone', 'üõ†Ô∏è'], ['SDS hammer', 'borhammer', 'iskuvasara', 'üõ†Ô∏è'], ['nail gun', 'spikerpistol', 'naulain', 'üî´'],
        ['concrete mixer', 'betongblander', 'betonimylly', 'üåÄ'], ['rebar bender', 'armeringsknekker', 'raudoituksen taivuttaja', 'üîß'], ['trowel', 'murerskje', 'lastalapio', 'üß±'],
        ['plate compactor', 'platevibrator', 't√§ryl√§mp√∂', 'üì≥'], ['jackhammer', 'pigghammer', 'piikkirikki', 'üí•'], ['planer', 'h√∏vel', 'h√∂yl√§', 'ü™µ'],
        ['router', 'overfres', 'yl√§jyrsin', 'ü™µ'], ['sander', 'sliper', 'hiomakone', 'ü™µ'], ['pipe wrench', 'r√∏rtang', 'putkipihdit', 'üîß'],
        ['pipe cutter', 'r√∏rkutter', 'putkileikkuri', 'üîß'], ['wire stripper', 'avmantlingstang', 'eristysraudat', 'üîå'], ['multimeter', 'multimeter', 'yleismittari', 'üîå'],
        ['ladder', 'stige', 'tikkaat', 'ü™ú'], ['scaffold', 'stillas', 'rakennustelineet', 'üßó'], ['wheelbarrow', 'trilleb√•r', 'kottik√§rryt', 'üõí'],
        ['generator', 'aggregat', 'generaattori', '‚ö°'], ['work light', 'arbeidslampe', 'ty√∂valo', 'üí°'], ['extension cord', 'skj√∏teledning', 'jatkojohto', 'üîå'],
        ['PPE', 'verneutstyr', 'suojavarusteet', 'ü¶∫'], ['safety helmet', 'vernehjelm', 'suojakyp√§r√§', 'ü™ñ']
      ].map(([en, no, fi, icon]) => W('Tools Gallery (Ikoner)', en, no, fi, icon)),

      // Site slang
      P('Site Slang (Bygge-slang)', 'All good / No worries.', 'Null stress.', 'Ei huolta.', 'üòé'),
      P('Site Slang (Bygge-slang)', "Let's go / Go for it!", 'Kj√∏r p√•!', 'Menn√§√§n!', 'üèÅ'),
      P('Site Slang (Bygge-slang)', 'Looks solid.', 'Ser bra ut.', 'N√§ytt√§√§ hyv√§lt√§.', 'üëç'),
      P('Site Slang (Bygge-slang)', 'Take five.', 'Ta fem.', 'Pid√§ tauko.', 'üñêÔ∏è'),
      P('Site Slang (Bygge-slang)', 'On center / On the line.', 'P√• senter / p√• streken.', 'Keskell√§ / viivalla.', 'üìè'),
      P('Site Slang (Bygge-slang)', 'Make it level / plumb.', 'I vater / i lodd.', 'Vaakaan / luotiin.', 'üìê'),
      P('Site Slang (Bygge-slang)', 'Hit it (with force).', "Gi'n juling.", 'Ly√∂ kovaa.', 'üí™'),

      // Small Talk
      P('Small Talk (Sm√•prat)', 'How are you?', 'Hvordan g√•r det?', 'Mit√§ kuuluu?'),
      P('Small Talk (Sm√•prat)', 'Nice to meet you.', 'Hyggelig √• m√∏te deg.', 'Hauska tavata.'),
      P('Small Talk (Sm√•prat)', 'Do you speak English?', 'Snakker du engelsk?', 'Puhutko englantia?'),
      P('Small Talk (Sm√•prat)', 'See you tomorrow.', 'Vi sees i morgen.', 'N√§hd√§√§n huomenna.'),
      P('Small Talk (Sm√•prat)', 'Thank you very much.', 'Tusen takk.', 'Kiitos paljon.'),
      P('Small Talk (Sm√•prat)', "You're welcome.", 'V√¶r s√• god.', 'Ole hyv√§.'),
      P('Small Talk (Sm√•prat)', 'Excuse me / Sorry.', 'Unnskyld.', 'Anteeksi.'),
      P('Small Talk (Sm√•prat)', 'Good morning / Good evening.', 'God morgen / God kveld.', 'Hyv√§√§ huomenta / Hyv√§√§ iltaa.'),

      // Shopping & Food
      P('Shopping & Food (Butikk & Mat)', 'How much does it cost?', 'Hvor mye koster det?', 'Paljonko t√§m√§ maksaa?'),
      W('Shopping & Food (Butikk & Mat)', 'card / cash / receipt', 'kort / kontanter / kvittering', 'kortti / k√§teinen / kuitti'),
      W('Shopping & Food (Butikk & Mat)', 'bag', 'pose', 'pussi'),
      W('Shopping & Food (Butikk & Mat)', 'bread / milk / eggs', 'br√∏d / melk / egg', 'leip√§ / maito / munat'),
      W('Shopping & Food (Butikk & Mat)', 'water / coffee / beer', 'vann / kaffe / √∏l', 'vesi / kahvi / olut'),
      P('Shopping & Food (Butikk & Mat)', 'Where is the nearest supermarket?', 'Hvor er n√¶rmeste butikk?', 'Miss√§ on l√§hin ruokakauppa?'),
      P('Shopping & Food (Butikk & Mat)', 'Can I pay by card?', 'Kan jeg betale med kort?', 'Voinko maksaa kortilla?'),

      // Money & Exchange - NEW CATEGORY
      P('Money & Exchange (Penger & Veksling)', 'How much for one?', 'Hvor mye for √©n?', 'Paljonko yhdest√§?'),
      P('Money & Exchange (Penger & Veksling)', 'How much for two?', 'Hvor mye for to?', 'Paljonko kahdesta?'),
      P('Money & Exchange (Penger & Veksling)', 'How much for three?', 'Hvor mye for tre?', 'Paljonko kolmesta?'),
      P('Money & Exchange (Penger & Veksling)', 'How much for four?', 'Hvor mye for fire?', 'Paljonko nelj√§st√§?'),
      P('Money & Exchange (Penger & Veksling)', 'How much for five?', 'Hvor mye for fem?', 'Paljonko viidest√§?'),
      P('Money & Exchange (Penger & Veksling)', 'Can you change 100?', 'Kan du veksle 100?', 'Voitko vaihtaa 100?'),
      P('Money & Exchange (Penger & Veksling)', 'Can you change 200?', 'Kan du veksle 200?', 'Voitko vaihtaa 200?'),
      P('Money & Exchange (Penger & Veksling)', 'Can you change 500?', 'Kan du veksle 500?', 'Voitko vaihtaa 500?'),
      P('Money & Exchange (Penger & Veksling)', 'Can you change 1000?', 'Kan du veksle 1000?', 'Voitko vaihtaa 1000?'),
      P('Money & Exchange (Penger & Veksling)', 'Have you got exchange?', 'Har dere veksling?', 'Onko teill√§ valuutanvaihtoa?'),
      P('Money & Exchange (Penger & Veksling)', 'Where can I exchange money?', 'Hvor kan jeg veksle penger?', 'Miss√§ voin vaihtaa rahaa?'),
      P('Money & Exchange (Penger & Veksling)', "What's the exchange rate?", 'Hva er kursen?', 'Mik√§ on vaihtokurssi?'),
      W('Money & Exchange (Penger & Veksling)', 'Norwegian Krone (NOK)', 'Norske kroner (NOK)', 'Norjan kruunu (NOK)', 'üí∞'),
      W('Money & Exchange (Penger & Veksling)', 'Euro (EUR)', 'Euro (EUR)', 'Euro (EUR)', 'üí∂'),
      W('Money & Exchange (Penger & Veksling)', 'US Dollar (USD)', 'Amerikanske dollar (USD)', 'Amerikan dollari (USD)', 'üíµ'),

      // Transport
      P('Transport (Transport)', 'Where is the bus stop?', 'Hvor er bussholdeplassen?', 'Miss√§ on bussipys√§kki?'),
      P('Transport (Transport)', 'Which line goes to ‚Ä¶?', 'Hvilken linje g√•r til ‚Ä¶?', 'Mik√§ linja menee ‚Ä¶?'),
      P('Transport (Transport)', 'A ticket to Oslo, please.', 'En billett til Oslo, takk.', 'Lippu Osloon, kiitos.'),
      P('Transport (Transport)', 'Where is the train station?', 'Hvor er jernbanestasjonen?', 'Miss√§ on rautatieasema?'),
      P('Transport (Transport)', 'How much is a ticket?', 'Hvor mye koster en billett?', 'Paljonko lippu maksaa?'),

      // Health & Emergency
      P('Health & Emergency (Helse & N√∏d)', 'Call 113!', 'Ring 113!', 'Soita 112!'),
      P('Health & Emergency (Helse & N√∏d)', 'I need a doctor.', 'Jeg trenger en lege.', 'Tarvitsen l√§√§k√§rin.'),
      P('Health & Emergency (Helse & N√∏d)', 'Help!', 'Hjelp!', 'Apua!'),
      P('Health & Emergency (Helse & N√∏d)', 'I am sick.', 'Jeg er syk.', 'Olen sairas.'),

      // Housing & Utilities
      P('Housing & Utilities (Bolig & Tjenester)', 'Is electricity included?', 'Er str√∏m inkludert?', 'Sis√§ltyyk√∂ s√§hk√∂?'),
      P('Housing & Utilities (Bolig & Tjenester)', 'Where is the nearest laundry?', 'Hvor er n√¶rmeste vaskeri?', 'Miss√§ on l√§hin pesula?'),

      // Admin
      W('Admin (Papirer & Kontor)', 'tax card', 'skattekort', 'verokortti'),
      W('Admin (Papirer & Kontor)', 'National ID no. / D-number', 'f√∏dselsnummer / D-nummer', 'henkil√∂tunnus'),
      
      // Quantities - NEW CATEGORY
      P('Quantities (Mengder)', 'A little / A lot', 'Litt / Mye', 'V√§h√§n / Paljon'),
      P('Quantities (Mengder)', 'More / Less', 'Mer / Mindre', 'Enemm√§n / V√§hemm√§n'),
      P('Quantities (Mengder)', 'Half / Quarter', 'Halv / Kvart', 'Puoli / Nelj√§nnes'),
      W('Quantities (Mengder)', 'kilogram / liter / meter', 'kilo / liter / meter', 'kilo / litra / metri'),

      // Weather - NEW CATEGORY
      W('Weather (V√¶r)', 'sunny', 'sol', 'aurinkoinen', '‚òÄÔ∏è'),
      W('Weather (V√¶r)', 'rainy', 'regn', 'sateinen', 'üåßÔ∏è'),
      W('Weather (V√¶r)', 'cloudy', 'overskyet', 'pilvinen', '‚òÅÔ∏è'),
      W('Weather (V√¶r)', 'snow', 'sn√∏', 'lumi', '‚ùÑÔ∏è'),
      W('Weather (V√¶r)', 'wind', 'vind', 'tuuli', 'üí®'),
      P('Weather (V√¶r)', 'How is the weather?', 'Hvordan er v√¶ret?', 'Millainen s√§√§ on?'),
      P('Weather (V√¶r)', 'It is cold / warm.', 'Det er kaldt / varmt.', 'On kylm√§ / l√§mmin.'),

      // Restaurants & Dining - NEW CATEGORY
      P('Restaurants & Dining (Restaurant & Mat)', 'Table for two, please.', 'Bord for to, takk.', 'P√∂yt√§ kahdelle, kiitos.'),
      P('Restaurants & Dining (Restaurant & Mat)', 'The menu, please.', 'Menyen, takk.', 'Ruokalista, kiitos.'),
      P('Restaurants & Dining (Restaurant & Mat)', 'Can I have the bill?', 'Kan jeg f√• regningen?', 'Voinko saada laskun?'),
      P('Restaurants & Dining (Restaurant & Mat)', 'Do you have vegetarian options?', 'Har dere vegetarmat?', 'Onko teill√§ kasvisvaihtoehtoja?'),
      P('Restaurants & Dining (Restaurant & Mat)', 'This is delicious!', 'Dette er deilig!', 'T√§m√§ on herkullista!'),

      // Colors - NEW CATEGORY
      W('Colors (Farger)', 'red', 'r√∏d', 'punainen', 'üî¥'),
      W('Colors (Farger)', 'blue', 'bl√•', 'sininen', 'üîµ'),
      W('Colors (Farger)', 'green', 'gr√∏nn', 'vihre√§', 'üü¢'),
      W('Colors (Farger)', 'yellow', 'gul', 'keltainen', 'üü°'),
      W('Colors (Farger)', 'black', 'svart', 'musta', '‚ö´'),
      W('Colors (Farger)', 'white', 'hvit', 'valkoinen', '‚ö™'),
      W('Colors (Farger)', 'orange', 'oransje', 'oranssi', 'üü†'),
      W('Colors (Farger)', 'brown', 'brun', 'ruskea', 'üü§'),

      // Directions - NEW CATEGORY
      W('Directions (Retninger)', 'left', 'venstre', 'vasen', '‚¨ÖÔ∏è'),
      W('Directions (Retninger)', 'right', 'h√∏yre', 'oikea', '‚û°Ô∏è'),
      W('Directions (Retninger)', 'straight', 'rett fram', 'suoraan', '‚¨ÜÔ∏è'),
      W('Directions (Retninger)', 'back', 'tilbake', 'takaisin', '‚¨áÔ∏è'),
      W('Directions (Retninger)', 'north / south', 'nord / s√∏r', 'pohjoinen / etel√§', 'üß≠'),
      W('Directions (Retninger)', 'east / west', '√∏st / vest', 'it√§ / l√§nsi', 'üß≠'),
      P('Directions (Retninger)', 'Where is...?', 'Hvor er...?', 'Miss√§ on...?'),
      P('Directions (Retninger)', 'How do I get to...?', 'Hvordan kommer jeg til...?', 'Miten p√§√§sen...?'),

      // Bergen Places - NEW CATEGORY
      P('Bergen Places (Bergen Steder)', 'Fish Market (Fisketorget)', 'Fisketorget', 'Kalatori', 'üêü'),
      P('Bergen Places (Bergen Steder)', 'Bryggen (UNESCO site)', 'Bryggen', 'Bryggen', 'üèõÔ∏è'),
      P('Bergen Places (Bergen Steder)', 'Fl√∏yen Mountain', 'Fl√∏yen', 'Fl√∏yen', '‚õ∞Ô∏è'),
      P('Bergen Places (Bergen Steder)', 'Bergen Railway Station', 'Bergen stasjon', 'Bergenin rautatieasema', 'üöÇ'),
      P('Bergen Places (Bergen Steder)', 'Bergen University', 'Universitetet i Bergen', 'Bergenin yliopisto', 'üéì'),
      P('Bergen Places (Bergen Steder)', 'Torgallmenningen (main square)', 'Torgallmenningen', 'Torgallmenningen', 'üèõÔ∏è'),
      P('Bergen Places (Bergen Steder)', 'Bergen Bus Station', 'Bergen busstasjon', 'Bergenin linja-autoasema', 'üöå'),

      // Numbers
      ...Numbers('Numbers & Time (Tall & Tid)')
    ].flat();

    // UI elements
    const list = document.getElementById('list');
    const chips = document.getElementById('chips');
    const q = document.getElementById('q');
    const hideEn = document.getElementById('hideEn');
    const onlyFav = document.getElementById('onlyFav');
    const themeSel = document.getElementById('theme');
    const appEl = document.getElementById('app');
    const exportFav = document.getElementById('exportFav');
    const targetLangSel = document.getElementById('targetLang');
    const currencyCalcBtn = document.getElementById('currencyCalc');
    const placesBtnEl = document.getElementById('placesBtn');
    const currencyModal = document.getElementById('currencyModal');
    const placesModal = document.getElementById('placesModal');
    const closeCurrency = document.getElementById('closeCurrency');
    const closePlaces = document.getElementById('closePlaces');

    // Theme initialization
    function initTheme() {
      if (state.theme === 'dark') {
        appEl.removeAttribute('data-theme');
      } else {
        appEl.setAttribute('data-theme', state.theme);
      }
      themeSel.value = state.theme;
    }

    themeSel.addEventListener('change', (e) => {
      state.theme = e.target.value;
      localStorage.setItem('nqt_theme', state.theme);
      initTheme();
    });

    // Language switching
    targetLangSel.value = state.targetLang;
    targetLangSel.addEventListener('change', (e) => {
      state.targetLang = e.target.value;
      localStorage.setItem('nqt_targetLang', state.targetLang);
      render();
    });

    // Category chips
    CATS.forEach(cat => {
      const c = document.createElement('button');
      c.className = 'chip';
      c.textContent = cat;
      c.setAttribute('role', 'tab');
      c.setAttribute('aria-selected', cat === state.cat);
      c.onclick = () => {
        state.cat = cat;
        render();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      chips.appendChild(c);
    });

    // Search and toggles
    q.addEventListener('input', (e) => {
      state.q = e.target.value.trim();
      render();
    });

    hideEn.checked = state.hideEn;
    onlyFav.checked = state.onlyFav;

    hideEn.addEventListener('change', (e) => {
      state.hideEn = e.target.checked;
      render();
    });

    onlyFav.addEventListener('change', (e) => {
      state.onlyFav = e.target.checked;
      render();
    });

    exportFav.addEventListener('click', () => {
      const favItems = D.filter(x => state.favs.has(x.id));
      if (favItems.length === 0) {
        showToast('No favorites to export yet!', true);
        return;
      }
      const blob = new Blob([JSON.stringify(favItems, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'norsk_quicktalk_favorites.json';
      a.click();
      URL.revokeObjectURL(a.href);
      showToast('Favorites exported successfully!');
    });

    // Currency Calculator
    currencyCalcBtn.addEventListener('click', () => {
      currencyModal.style.display = 'block';
      fetchExchangeRates();
    });

    closeCurrency.addEventListener('click', () => {
      currencyModal.style.display = 'none';
    });

    // Bergen Places
    placesBtnEl.addEventListener('click', () => {
      placesModal.style.display = 'block';
      renderPlaces();
    });

    closePlaces.addEventListener('click', () => {
      placesModal.style.display = 'none';
    });

    // Close modals on outside click
    window.addEventListener('click', (e) => {
      if (e.target === currencyModal) {
        currencyModal.style.display = 'none';
      }
      if (e.target === placesModal) {
        placesModal.style.display = 'none';
      }
    });

    // Currency conversion
    async function fetchExchangeRates() {
      const now = Date.now();
      const lastUpdate = state.lastRateUpdate ? parseInt(state.lastRateUpdate) : 0;
      const oneHour = 60 * 60 * 1000;

      if (now - lastUpdate < oneHour && Object.keys(state.exchangeRates).length > 0) {
        return; // Use cached rates
      }

      try {
        // Using exchangerate-api.com free tier (no auth needed)
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/NOK');
        const data = await response.json();
        
        if (data && data.rates) {
          state.exchangeRates = data.rates;
          state.lastRateUpdate = now.toString();
          localStorage.setItem('nqt_exchangeRates', JSON.stringify(state.exchangeRates));
          localStorage.setItem('nqt_lastRateUpdate', state.lastRateUpdate);
          showToast('Exchange rates updated successfully!');
        }
      } catch (error) {
        console.error('Failed to fetch exchange rates:', error);
        showToast('Failed to update exchange rates. Using cached data.', true);
      }
    }

    function convertCurrency() {
      const fromAmount = parseFloat(document.getElementById('fromAmount').value);
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      
      if (!fromAmount || isNaN(fromAmount)) {
        showToast('Please enter a valid amount', true);
        return;
      }

      // Simple conversion using NOK as base
      let result;
      if (Object.keys(state.exchangeRates).length === 0) {
        // Fallback rates if API is unavailable
        const fallbackRates = { EUR: 0.089, USD: 0.094, GBP: 0.075, SEK: 1.03, DKK: 0.66, NOK: 1 };
        const fromRate = fallbackRates[fromCurrency] || 1;
        const toRate = fallbackRates[toCurrency] || 1;
        result = (fromAmount / fromRate) * toRate;
      } else {
        const fromRate = state.exchangeRates[fromCurrency] || 1;
        const toRate = state.exchangeRates[toCurrency] || 1;
        result = (fromAmount / fromRate) * toRate;
      }

      document.getElementById('toAmount').value = result.toFixed(2);
      document.getElementById('rateInfo').textContent = `1 ${fromCurrency} = ${(1 / (state.exchangeRates[fromCurrency] || 1) * (state.exchangeRates[toCurrency] || 1)).toFixed(4)} ${toCurrency}`;
    }

    document.getElementById('convertBtn')?.addEventListener('click', convertCurrency);
    document.getElementById('swapBtn')?.addEventListener('click', () => {
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      document.getElementById('fromCurrency').value = toCurrency;
      document.getElementById('toCurrency').value = fromCurrency;
      convertCurrency();
    });

    document.getElementById('fromAmount')?.addEventListener('input', convertCurrency);

    // Bergen Places
    function renderPlaces() {
      const placesList = document.getElementById('placesList');
      const mapContainer = document.getElementById('mapContainer');
      
      // Display saved places
      if (state.savedPlaces.length === 0) {
        placesList.innerHTML = '<p style="color: var(--muted); padding: 10px;">No places saved yet. Add your favorite Bergen spots!</p>';
      } else {
        placesList.innerHTML = state.savedPlaces.map((place, idx) => `
          <div class="place-item">
            <div>
              <strong>${esc(place.name)}</strong>
              <span class="badge">${esc(place.category)}</span>
            </div>
            <button class="btn" onclick="deletePlace(${idx})">Delete</button>
          </div>
        `).join('');
      }

      // Note: Mapbox requires API key, so we'll show a placeholder
      mapContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--muted);">üó∫Ô∏è Map integration (add Mapbox API key to enable)</div>';
    }

    window.deletePlace = function(idx) {
      state.savedPlaces.splice(idx, 1);
      localStorage.setItem('nqt_savedPlaces', JSON.stringify(state.savedPlaces));
      renderPlaces();
      showToast('Place deleted');
    };

    document.getElementById('addPlaceBtn')?.addEventListener('click', () => {
      const name = document.getElementById('newPlaceName').value.trim();
      const category = document.getElementById('newPlaceCategory').value.trim();
      
      if (!name || !category) {
        showToast('Please enter both name and category', true);
        return;
      }

      state.savedPlaces.push({ name, category });
      localStorage.setItem('nqt_savedPlaces', JSON.stringify(state.savedPlaces));
      document.getElementById('newPlaceName').value = '';
      document.getElementById('newPlaceCategory').value = '';
      renderPlaces();
      showToast('Place added successfully!');
    });

    function speak(text) {
      if (!('speechSynthesis' in window)) {
        showToast('Text-to-speech is not supported in this browser.', true);
        return;
      }
      const utterance = new SpeechSynthesisUtterance(text);
      // Set language based on target language
      utterance.lang = state.targetLang === 'fi' ? 'fi-FI' : 'nb-NO';
      utterance.rate = 1;
      utterance.pitch = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(utterance);
    }

    function copy(txt) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(txt).then(() => {
          showToast('Copied to clipboard!');
        }).catch(err => {
          console.error('Failed to copy text:', err);
          showToast('Failed to copy. Please try again.', true);
        });
      } else {
        showToast('Clipboard not supported in this browser.', true);
      }
    }

    // Simple toast notification system
    function showToast(message, isError = false) {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.className = 'toast' + (isError ? ' toast-error' : '');
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--card);
        border: 1px solid var(--border);
        padding: 12px 20px;
        border-radius: 10px;
        box-shadow: var(--shadow);
        color: var(--text);
        font-weight: 600;
        z-index: 1000;
        animation: slideIn 0.3s ease;
      `;
      if (isError) {
        toast.style.borderColor = 'var(--accent-2)';
      } else {
        toast.style.borderColor = 'var(--accent)';
      }
      
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    function highlight(hay, needle) {
      if (!needle) return esc(hay);
      const re = new RegExp('(' + needle.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'ig');
      return esc(hay).replace(re, '<mark>$1</mark>');
    }

    // HTML escape map for security
    const ESC_MAP = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    };

    function esc(s) {
      return s.replace(/[&<>"']/g, c => ESC_MAP[c]);
    }

    function render() {
      // Update chip active states
      [...chips.children].forEach(chip => {
        const isActive = chip.textContent === state.cat;
        chip.classList.toggle('active', isActive);
        chip.setAttribute('aria-selected', isActive);
      });

      // Filter items
      let items = D.filter(x => x.cat === state.cat);
      if (state.q) {
        const ql = state.q.toLowerCase();
        items = items.filter(x => 
          x.en.toLowerCase().includes(ql) || 
          x.no.toLowerCase().includes(ql) ||
          (x.fi && x.fi.toLowerCase().includes(ql))
        );
      }
      if (state.onlyFav) {
        items = items.filter(x => state.favs.has(x.id));
      }

      // Render list
      if (items.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="12" cy="12" r="10" stroke-width="1.5"/>
              <path d="M8 12h8M12 8v8" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <p>No phrases found. Try a different search or category.</p>
          </div>
        `;
        return;
      }

      list.innerHTML = items.map(it => {
        const fav = state.favs.has(it.id);
        const en = highlight(it.en, state.q);
        // Use selected target language
        const targetText = state.targetLang === 'fi' ? (it.fi || it.no) : it.no;
        const targetHighlighted = highlight(targetText, state.q);
        const icon = it.icon ? `<span class="icon" aria-hidden="true">${esc(it.icon)}</span>` : '';
        const slangBadge = it.cat.includes('Slang') ? '<span class="badge">slang</span>' : '';
        
        return `<article class="card ${state.hideEn ? 'hide-en' : ''}" data-id="${it.id}">
          <div class="row">
            <div class="no">
              ${icon}
              <span>${targetHighlighted}</span>
              ${slangBadge}
            </div>
            <div class="actions">
              <button class="iconbtn" title="Play Norwegian" data-act="speak" aria-label="Play Norwegian pronunciation">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7-11-7z"/>
                </svg>
              </button>
              <button class="iconbtn" title="Copy Norwegian" data-act="copy-no" aria-label="Copy Norwegian text">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <rect x="9" y="9" width="11" height="11" rx="2" stroke="currentColor"/>
                  <rect x="4" y="4" width="11" height="11" rx="2" stroke="currentColor" opacity=".6"/>
                </svg>
              </button>
              <button class="iconbtn" title="Favorite" data-act="fav" aria-pressed="${fav}" aria-label="${fav ? 'Remove from favorites' : 'Add to favorites'}">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="${fav ? 'currentColor' : 'none'}" stroke="${fav ? 'none' : 'currentColor'}">
                  <path d="M12 17.3l-5.3 3.1 1.4-6-4.6-4 6.1-.5L12 4l2.4 5.9 6.1.5-4.6 4 1.4 6z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="en">${en}</div>
        </article>`;
      }).join('');

      // Attach event listeners
      list.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', (e) => {
          const btn = e.target.closest('button');
          if (!btn) return;
          
          const id = card.getAttribute('data-id');
          const item = D.find(x => x.id === id);
          if (!item) return;
          
          const act = btn.getAttribute('data-act');
          const targetText = state.targetLang === 'fi' ? (item.fi || item.no) : item.no;
          
          if (act === 'speak') {
            speak(targetText);
            // Track learning progress
            state.learnProgress[id] = (state.learnProgress[id] || 0) + 1;
            localStorage.setItem('nqt_learnProgress', JSON.stringify(state.learnProgress));
          } else if (act === 'copy-no') {
            copy(targetText);
          } else if (act === 'fav') {
            if (state.favs.has(id)) {
              state.favs.delete(id);
            } else {
              state.favs.add(id);
            }
            localStorage.setItem('nqt_favs', JSON.stringify([...state.favs]));
            render();
          }
        });
      });
    }

    // Initialize and render
    initTheme();
    render();
  </script>
</body>
</html>
